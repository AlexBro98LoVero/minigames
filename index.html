<!doctype html>
<html lang="it">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flashcards — Gioco</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#1E90FF; --glass: rgba(255,255,255,0.04);
      --muted: #9aa6bd; --white: #e6eef8;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg) 0%, #071023 100%);color:var(--white);font-size:18px}
    .app{display:grid;grid-template-columns:260px 1fr;gap:24px;min-height:100vh;padding:28px}
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:18px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .logo{font-weight:700;color:var(--accent);font-size:20px;margin-bottom:12px}
    details{margin-bottom:10px}
    details summary{cursor:pointer;color:var(--muted);font-size:15px;list-style:none}
    details[open] summary{color:var(--white);}
    .chapters{display:flex;flex-direction:column;gap:6px;margin-top:6px}
    .btn{background:transparent;border:0;padding:10px 12px;border-radius:10px;color:var(--white);cursor:pointer;text-align:left;font-size:16px}
    .btn:hover{background:var(--glass)}
    .btn.active{background:linear-gradient(90deg, rgba(30,144,255,0.12), rgba(30,144,255,0.06));box-shadow:0 4px 14px rgba(30,144,255,0.08);}
    .main{padding:12px;display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center;position:relative;padding-top:80px}
    .home-btn{position:fixed;left:308px;top:28px;padding:10px 18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.08);border-radius:8px;color:var(--white);cursor:pointer;font-size:15px;font-weight:600;white-space:nowrap;z-index:1000}
    .home-btn:hover{background:var(--glass);border-color:rgba(255,255,255,0.12)}
    .topbar{margin-bottom:16px;position:relative;width:100%;max-width:600px}
    .title{font-size:24px;font-weight:700}
    .sub{color:var(--muted);font-size:16px}
    .home-controls{display:flex;gap:16px;margin-bottom:24px;justify-content:center}
    .control-btn{position:relative;padding:12px 20px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.08);border-radius:10px;color:var(--white);cursor:pointer;font-size:16px;font-weight:600}
    .control-btn:hover{background:var(--glass);border-color:rgba(255,255,255,0.12)}
    .dropdown{position:absolute;top:calc(100% + 8px);left:0;background:linear-gradient(180deg, rgba(15,23,36,0.98), rgba(11,18,32,0.98));border:1px solid rgba(255,255,255,0.08);border-radius:10px;padding:12px;box-shadow:0 8px 24px rgba(2,6,23,0.8);z-index:100;min-width:220px}
    .dropdown label{display:flex;align-items:center;gap:8px;padding:8px;cursor:pointer;font-size:15px;border-radius:6px}
    .dropdown label:hover{background:var(--glass)}
    .dropdown input[type="checkbox"]{width:18px;height:18px;cursor:pointer}
    .dropdown.timer-dropdown{min-width:180px}
    .timer-option{padding:10px;cursor:pointer;border-radius:6px;font-size:15px}
    .timer-option:hover{background:var(--glass)}
    .timer-option.selected{background:linear-gradient(90deg, rgba(30,144,255,0.12), rgba(30,144,255,0.06))}
    .timer-display{font-size:48px;font-weight:700;color:var(--accent);margin-bottom:20px;min-height:60px;display:flex;align-items:center;justify-content:center}
    .timer-display:empty{display:none}
    .timer-display.warning{color:#f59e0b}
    .timer-display.danger{color:#ef4444;animation:pulse 0.5s ease-in-out infinite}
    @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.7}}
    .card-wrap{perspective:1200px;margin-bottom:16px;display:flex;justify-content:center}
    .card{width:340px;height:280px;border-radius:14px;position:relative;transform-style:preserve-3d;transition:transform .6s;cursor:pointer;margin:auto}
    .card.flipped{transform:rotateY(180deg)}
    .face{position:absolute;inset:0;border-radius:14px;backface-visibility:hidden;display:flex;align-items:center;justify-content:center;padding:20px;box-shadow:0 8px 24px rgba(2,6,23,0.6);font-size:18px;flex-direction:column}
    .front{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
    .back{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03);transform:rotateY(180deg)}
    .question{font-size:18px;text-align:center}
    .answer{font-size:17px;text-align:center;color:var(--muted)}
    .options{display:flex;flex-direction:column;gap:10px;width:100%;margin-top:12px}
    .option-btn{padding:10px 16px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.08);border-radius:8px;color:var(--white);cursor:pointer;font-size:15px;text-align:left}
    .option-btn:hover{background:var(--glass)}
    .option-btn.correct{background:linear-gradient(90deg, rgba(34,197,94,0.12), rgba(34,197,94,0.06));border-color:rgba(34,197,94,0.3)}
    .option-btn.wrong{background:linear-gradient(90deg, rgba(239,68,68,0.12), rgba(239,68,68,0.06));border-color:rgba(239,68,68,0.3)}
    #nextBtn{margin-top:16px;padding:12px 20px;background:var(--accent);border:none;border-radius:10px;color:white;cursor:pointer;font-weight:600;font-size:16px}
    #nextBtn:hover{opacity:0.9}
    .hidden{display:none !important}
    @media(max-width:820px){.app{grid-template-columns:1fr;padding:16px}.sidebar{order:2}.home-controls{flex-direction:column}.home-btn{left:16px;top:16px}}
  </style>
</head>
<body>
  <div class="app">
    <aside class="sidebar" id="sidebar">
      <div class="logo">Flashcards — Gioco</div>
      <div id="subjects"></div>
    </aside>

    <main class="main">
      <div class="topbar">
        <button class="home-btn hidden" id="homeBtn">← Home</button>
        <div class="title" id="mainTitle">Seleziona una materia</div>
        <div class="sub" id="mainSub">Scegli un capitolo o prova tutte le domande di una materia.</div>
      </div>
      
      <div class="home-controls" id="homeControls">
        <div style="position:relative">
          <button class="control-btn" id="typeBtn">Tipo di domande ▾</button>
          <div class="dropdown hidden" id="typeDropdown">
            <label><input type="checkbox" id="typeOpen" checked> Senza risposta</label>
            <label><input type="checkbox" id="typeMultiple" checked> Risposta multipla</label>
            <label><input type="checkbox" id="typeTrueFalse" checked> Vero/Falso</label>
          </div>
        </div>
        
        <div style="position:relative">
          <button class="control-btn" id="timerBtn">Timer: Off ▾</button>
          <div class="dropdown timer-dropdown hidden" id="timerDropdown">
            <div class="timer-option selected" data-time="0">Nessun timer</div>
            <div class="timer-option" data-time="10">10 secondi</div>
            <div class="timer-option" data-time="15">15 secondi</div>
            <div class="timer-option" data-time="20">20 secondi</div>
            <div class="timer-option" data-time="25">25 secondi</div>
            <div class="timer-option" data-time="30">30 secondi</div>
          </div>
        </div>
      </div>
      
      <div class="timer-display" id="timerDisplay"></div>
      <section id="cardSection"></section>
      <button id="nextBtn" class="hidden">Successiva</button>
    </main>
  </div>

  <script>
    let DATA=[];
    
    // Carica i dati dal file JSON
    async function loadData(){
      try{
        const response=await fetch('domande.json');
        if(!response.ok)throw new Error('File non trovato');
        DATA=await response.json();
        createSidebar();
      }catch(error){
        console.error('Errore nel caricamento dei dati:',error);
        // Dati di esempio se il file non esiste
        DATA=[
          {id:'matematica',title:'Matematica',chapters:[
            {id:'algebra',title:'Algebra',cards:[
              {q:"Cos'è un polinomio?",a:"Un'espressione algebrica formata da monomi sommati.",type:'open'},
              {q:"Quale di queste è la formula corretta per il discriminante?",a:"b² - 4ac",type:'multiple',options:["b² + 4ac","b² - 4ac","2b - 4ac","b - 4ac²"],correct:1},
              {q:"Un quadrato ha tutti i lati uguali",a:"Vero",type:'truefalse',correct:true}]},
            {id:'analisi',title:'Analisi',cards:[
              {q:'Enuncia il Teorema Fondamentale del Calcolo',a:'Se f è continua su [a,b], allora... (riassunto).',type:'open'},
              {q:"Qual è la derivata di x²?",a:"2x",type:'multiple',options:["x","2x","x²","2"],correct:1},
              {q:"La derivata di una costante è zero",a:"Vero",type:'truefalse',correct:true}]}]},
          {id:'storia',title:'Storia',chapters:[
            {id:'medioevo',title:'Medioevo',cards:[
              {q:'Quando finisce il Medioevo?',a:'Tradizionalmente si prende il 1492 o il 1453 come date di confine.',type:'open'},
              {q:"In che anno Colombo scoprì l'America?",a:"1492",type:'multiple',options:["1453","1492","1500","1520"],correct:1},
              {q:"Il Medioevo durò circa 1000 anni",a:"Vero",type:'truefalse',correct:true}]}]}];
        createSidebar();
      }
    }

    let currentSubject=null,currentChapter=null,currentCards=[],currentIndex=0;
    let selectedTypes={open:true,multiple:true,truefalse:true};
    let timerSeconds=0;
    let timerInterval=null;
    let shuffledOptionsGlobal=[];
    
    const subjectsEl=document.getElementById('subjects');
    const mainTitle=document.getElementById('mainTitle');
    const mainSub=document.getElementById('mainSub');
    const cardSection=document.getElementById('cardSection');
    const nextBtn=document.getElementById('nextBtn');
    const homeControls=document.getElementById('homeControls');
    const typeBtn=document.getElementById('typeBtn');
    const typeDropdown=document.getElementById('typeDropdown');
    const timerBtn=document.getElementById('timerBtn');
    const timerDropdown=document.getElementById('timerDropdown');
    const timerDisplay=document.getElementById('timerDisplay');
    const homeBtn=document.getElementById('homeBtn');

    function createSidebar(){
      subjectsEl.innerHTML='';
      DATA.forEach(sub=>{
        const details=document.createElement('details');
        const summary=document.createElement('summary');
        summary.textContent=sub.title;
        details.appendChild(summary);
        const chapters=document.createElement('div');chapters.className='chapters';
        const allBtn=document.createElement('button');allBtn.className='btn';allBtn.textContent='Tutte le domande';
        allBtn.onclick=()=>selectSubject(sub.id,null,allBtn);
        chapters.appendChild(allBtn);
        sub.chapters.forEach(ch=>{
          const b=document.createElement('button');b.className='btn';b.textContent=ch.title;
          b.onclick=()=>selectSubject(sub.id,ch.id,b);
          chapters.appendChild(b);
        });
        details.appendChild(chapters);
        subjectsEl.appendChild(details);
      });
    }

    function selectSubject(subId,chapId,btnEl){
      document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
      if(btnEl) btnEl.classList.add('active');
      currentSubject=DATA.find(s=>s.id===subId);
      currentChapter=currentSubject&&chapId?currentSubject.chapters.find(c=>c.id===chapId):null;
      mainTitle.textContent=currentSubject?currentSubject.title:'Seleziona una materia';
      mainSub.textContent=currentChapter?currentChapter.title:(currentSubject?'Tutte le domande della materia':'Scegli un capitolo.');
      homeControls.classList.add('hidden');
      homeBtn.classList.remove('hidden');
      if(!currentSubject){currentCards=[];renderCard();return}
      let allCards=currentChapter?[...currentChapter.cards]:currentSubject.chapters.flatMap(ch=>ch.cards);
      currentCards=allCards.filter(card=>{
        if(card.type==='open'&&!selectedTypes.open)return false;
        if(card.type==='multiple'&&!selectedTypes.multiple)return false;
        if(card.type==='truefalse'&&!selectedTypes.truefalse)return false;
        return true;
      });
      shuffleArray(currentCards);
      currentIndex=0;
      nextBtn.classList.remove('hidden');
      renderCard();
    }

    function renderCard(){
      clearInterval(timerInterval);
      timerDisplay.textContent='';
      timerDisplay.className='timer-display';
      cardSection.innerHTML='';
      if(currentCards.length===0){
        cardSection.innerHTML='<div style="color:var(--muted);">Nessuna carta disponibile per i tipi selezionati.</div>';
        return;
      }
      if(currentIndex>=currentCards.length){
        cardSection.innerHTML='<div style="color:var(--muted);">Hai finito le carte!</div>';
        nextBtn.classList.add('hidden');
        return;
      }
      const cardData=currentCards[currentIndex];
      
      if(cardData.type==='open'){
        renderOpenCard(cardData);
      }else if(cardData.type==='multiple'){
        renderMultipleCard(cardData);
      }else if(cardData.type==='truefalse'){
        renderTrueFalseCard(cardData);
      }
      
      if(timerSeconds>0){
        startTimer();
      }
    }
    
    function renderOpenCard(cardData){
      const wrap=document.createElement('div');wrap.className='card-wrap';
      const c=document.createElement('div');c.className='card';c.id='mainCard';
      c.onclick=()=>{
        c.classList.toggle('flipped');
        if(c.classList.contains('flipped')){
          clearInterval(timerInterval);
          timerDisplay.textContent='';
        }
      };
      const front=document.createElement('div');front.className='face front';
      const p=document.createElement('div');p.className='question';p.textContent=cardData.q;
      front.appendChild(p);
      const back=document.createElement('div');back.className='face back';
      const a=document.createElement('div');a.className='answer';a.textContent=cardData.a;
      back.appendChild(a);
      c.appendChild(front);c.appendChild(back);wrap.appendChild(c);
      cardSection.appendChild(wrap);
    }
    
    function renderMultipleCard(cardData){
      const wrap=document.createElement('div');wrap.style.cssText='max-width:400px;margin:0 auto';
      const q=document.createElement('div');q.className='question';q.textContent=cardData.q;
      q.style.marginBottom='20px';
      wrap.appendChild(q);
      const optionsDiv=document.createElement('div');optionsDiv.className='options';
      
      shuffledOptionsGlobal=cardData.options.map((opt,idx)=>({text:opt,originalIndex:idx}));
      shuffleArray(shuffledOptionsGlobal);
      
      shuffledOptionsGlobal.forEach(opt=>{
        const btn=document.createElement('button');btn.className='option-btn';btn.textContent=opt.text;
        btn.onclick=()=>checkMultiple(opt.originalIndex,cardData.correct,optionsDiv);
        optionsDiv.appendChild(btn);
      });
      wrap.appendChild(optionsDiv);
      cardSection.appendChild(wrap);
    }
    
    function renderTrueFalseCard(cardData){
      const wrap=document.createElement('div');wrap.style.cssText='max-width:400px;margin:0 auto';
      const q=document.createElement('div');q.className='question';q.textContent=cardData.q;
      q.style.marginBottom='20px';
      wrap.appendChild(q);
      const optionsDiv=document.createElement('div');optionsDiv.className='options';
      const trueBtn=document.createElement('button');trueBtn.className='option-btn';trueBtn.textContent='Vero';
      trueBtn.onclick=()=>checkTrueFalse(true,cardData.correct,optionsDiv);
      const falseBtn=document.createElement('button');falseBtn.className='option-btn';falseBtn.textContent='Falso';
      falseBtn.onclick=()=>checkTrueFalse(false,cardData.correct,optionsDiv);
      optionsDiv.appendChild(trueBtn);optionsDiv.appendChild(falseBtn);
      wrap.appendChild(optionsDiv);
      cardSection.appendChild(wrap);
    }
    
    function checkMultiple(selected,correct,container){
      clearInterval(timerInterval);
      timerDisplay.textContent='';
      const btns=container.querySelectorAll('.option-btn');
      btns.forEach(btn=>{
        btn.disabled=true;
        btn.style.cursor='default';
        const btnIndex=Array.from(container.querySelectorAll('.option-btn')).findIndex(b=>b===btn);
        const originalIndex=shuffledOptionsGlobal[btnIndex].originalIndex;
        if(originalIndex===correct)btn.classList.add('correct');
        else if(originalIndex===selected)btn.classList.add('wrong');
      });
    }
    
    function checkTrueFalse(selected,correct,container){
      clearInterval(timerInterval);
      timerDisplay.textContent='';
      const btns=container.querySelectorAll('.option-btn');
      btns.forEach(btn=>{
        btn.disabled=true;
        btn.style.cursor='default';
        const isTrue=btn.textContent==='Vero';
        if(isTrue===correct)btn.classList.add('correct');
        else if(isTrue===selected)btn.classList.add('wrong');
      });
    }
    
    function startTimer(){
      let remaining=timerSeconds;
      updateTimerDisplay(remaining);
      timerInterval=setInterval(()=>{
        remaining--;
        updateTimerDisplay(remaining);
        if(remaining<=0){
          clearInterval(timerInterval);
          timerDisplay.textContent='';
          autoFlipOrNext();
        }
      },1000);
    }
    
    function updateTimerDisplay(seconds){
      timerDisplay.textContent=seconds+'s';
      timerDisplay.className='timer-display';
      if(seconds<=3){
        timerDisplay.classList.add('danger');
      }else if(seconds<=5){
        timerDisplay.classList.add('warning');
      }
    }
    
    function autoFlipOrNext(){
      const cardData=currentCards[currentIndex];
      if(cardData.type==='open'){
        const card=document.getElementById('mainCard');
        if(card&&!card.classList.contains('flipped')){
          card.classList.add('flipped');
          setTimeout(()=>{currentIndex++;renderCard();},2000);
        }
      }else{
        currentIndex++;
        renderCard();
      }
    }

    nextBtn.addEventListener('click',()=>{clearInterval(timerInterval);currentIndex++;renderCard();});

    function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]}return a}

    typeBtn.addEventListener('click',()=>{
      typeDropdown.classList.toggle('hidden');
      timerDropdown.classList.add('hidden');
    });
    
    timerBtn.addEventListener('click',()=>{
      timerDropdown.classList.toggle('hidden');
      typeDropdown.classList.add('hidden');
    });
    
    document.addEventListener('click',(e)=>{
      if(!typeBtn.contains(e.target)&&!typeDropdown.contains(e.target)){
        typeDropdown.classList.add('hidden');
      }
      if(!timerBtn.contains(e.target)&&!timerDropdown.contains(e.target)){
        timerDropdown.classList.add('hidden');
      }
    });
    
    document.getElementById('typeOpen').addEventListener('change',(e)=>{
      selectedTypes.open=e.target.checked;
    });
    document.getElementById('typeMultiple').addEventListener('change',(e)=>{
      selectedTypes.multiple=e.target.checked;
    });
    document.getElementById('typeTrueFalse').addEventListener('change',(e)=>{
      selectedTypes.truefalse=e.target.checked;
    });
    
    document.querySelectorAll('.timer-option').forEach(opt=>{
      opt.addEventListener('click',()=>{
        document.querySelectorAll('.timer-option').forEach(o=>o.classList.remove('selected'));
        opt.classList.add('selected');
        timerSeconds=parseInt(opt.dataset.time);
        timerBtn.textContent=timerSeconds>0?`Timer: ${timerSeconds}s ▾`:'Timer: Off ▾';
        timerDropdown.classList.add('hidden');
      });
    });

    homeBtn.addEventListener('click',()=>{
      clearInterval(timerInterval);
      currentSubject=null;
      currentChapter=null;
      currentCards=[];
      currentIndex=0;
      document.querySelectorAll('.btn').forEach(b=>b.classList.remove('active'));
      mainTitle.textContent='Seleziona una materia';
      mainSub.textContent='Scegli un capitolo o prova tutte le domande di una materia.';
      homeControls.classList.remove('hidden');
      homeBtn.classList.add('hidden');
      nextBtn.classList.add('hidden');
      cardSection.innerHTML='';
      timerDisplay.textContent='';
    });

    loadData();
    renderCard();
  </script>
</body>
</html>